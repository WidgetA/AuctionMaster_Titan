# CLAUDE.md — AuctionMaster 泰坦重铸迁移项目

> 本文档是 AI 开发助手的首要参考文件。每次开始新任务前，**必须先阅读并按需更新本文档**。

## 项目性质

这是一个**迁移项目**：将 AuctionMaster 插件从 WoW 经典怀旧服（Classic Era / TBC Classic, Interface 20501）迁移到**泰坦重铸版本**（Titan Reforged），使其能在新版本客户端上正常运行。

- 原始版本：Classic TBC (Interface: 20501)
- 目标版本：泰坦重铸（Titan Reforged, Interface: 38000）
- 框架：Ace3 全家桶（Release r1390）
- 全局命名空间：`vendor`
- SavedVariables：`VendorDb`, `AuctionMasterMiscDb`

## 文档维护协议

### 强制规则

1. **开发前必读**：每次开始新任务，先完整阅读本文件
2. **开发后必更新**：完成任务或遇到重要发现后，立即更新本文件的相关章节
3. **错误必记录**：任何因 API 变更、版本差异导致的错误和解决方案，必须记录在「已知问题与解决方案」章节
4. **无效尝试必记录**：尝试过但失败的方案，必须记录在「无效尝试记录」章节，避免重复踩坑

### 更新原则

- 只记录**已验证的结论**，不记录猜测
- 保持条目简洁，重点记录「做了什么 → 结果是什么 → 正确做法是什么」
- 过时的信息及时删除或标注

## 架构参考

详见 [ARCHITECTURE.md](doc/ARCHITECTURE.md) — 包含完整的模块结构、依赖关系、设计模式和数据流。

### 关键路径速查

| 用途 | 路径 |
|------|------|
| TOC 入口 | `AuctionMaster_Titan.toc` |
| 第三方库 | `libs/` |
| XML 模板 | `src/xml/` |
| 本地化 | `src/locale/` |
| 核心业务 | `src/main/` |
| 公开 API | `src/api/` |
| 测试 | `src/test/` |
| 插件主入口 | `src/main/Core/Vendor.lua` |
| 拍卖行核心 | `src/main/AuctionHouse/AuctionHouse.lua` |
| 扫描引擎 | `src/main/Scanner/Scanner.lua` |

## 迁移注意事项

详见 [API_CHANGES.md](doc/API_CHANGES.md) — 包含关键差异表和 WoW API 变更明细。遇到新的 API 变更时更新该文档。

## 已知问题与解决方案

详见 [KNOWN_ISSUES.md](doc/KNOWN_ISSUES.md) — 包含所有已解决问题的现象、根因和修复方式。

## 无效尝试记录

> 尝试过但被证明无效的方案，避免后续重复踩坑。

<!-- 格式：
### [日期] 尝试内容
- **目标**：想解决什么问题
- **做法**：具体怎么做的
- **结果**：为什么失败
- **教训**：从中学到了什么
-->

（暂无，随开发积累）

## 开发工作流

### 每次任务的标准流程

1. **阅读本文档** — 了解最新状态和已知问题
2. **阅读 doc/ARCHITECTURE.md** — 如果涉及不熟悉的模块
3. **开始开发** — 代码修改
4. **更新本文档** — 记录新发现、新问题、新方案
5. **提交代码** — 确保文档和代码一起更新

### 代码修改原则

- **最小改动**：迁移以「能跑」为第一目标，不做不必要的重构
- **保留原始逻辑**：除非 API 强制变更，否则不改变原有业务逻辑
- **注释变更原因**：对每处因迁移而改动的代码，添加注释说明改动原因，格式：`-- [Titan Migration] 原因说明`
- **libs 目录谨慎修改**：第三方库优先通过升级版本解决兼容问题，避免直接改库代码

## 当前进度

> 已完成事项详见 [PROGRESS.md](doc/PROGRESS.md)。

### 进行中

（暂无）

### 待办

- [ ] 逐模块排查 WoW API 兼容性
- [ ] 游戏内加载测试
